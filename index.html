<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>‡∏Ñ‡∏∏‡∏ì‡∏£‡∏±‡∏Å‡πÄ‡∏£‡∏≤‡πÑ‡∏´‡∏° üíï ‚Üí M1 Memory</title>
<style>
  :root{
    --pink1:#ffe6ef; --pink3:#fbeafe;
    --text:#3d2b3a; --muted:#6f5b66; --shadow:rgba(0,0,0,.16); --card:#ffffff;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,"Noto Sans Thai",sans-serif;color:var(--text);background:linear-gradient(135deg,var(--pink1),var(--pink3))}
  .hidden{display:none!important}
  .center{display:flex;align-items:center;justify-content:center}
  .btn{cursor:pointer;padding:.9rem 1.2rem;border:none;border-radius:999px;background:#ff7aa2;color:#fff;font-weight:700;box-shadow:0 10px 24px var(--shadow);transition:.2s}
  .btn:hover{transform:translateY(-2px)}
  .btn.secondary{background:#fff;color:#ff7aa2;border:2px solid #ff7aa2}
  .tiny{font-size:.95rem;color:var(--muted)}
  .badge{display:inline-block;background:#ffe6ef;color:#c2185b;border-radius:999px;padding:6px 12px;font-weight:700}

  /* Gate */
  #gate{min-height:100dvh;position:relative;overflow:hidden;padding:20px}
  #gateCard{max-width:760px;margin:auto;background:var(--card);border-radius:22px;box-shadow:0 16px 48px var(--shadow);padding:28px;text-align:center;position:relative;z-index:2}

  /* Main */
  #main{min-height:100dvh;position:relative;overflow:hidden;padding:28px}
  .wrap{max-width:980px;margin:0 auto}
  h1.title{margin:8px 0 18px;text-align:center;font-size:clamp(28px,5vw,48px)}
  .hero{background:var(--card);border:1px solid #ffe0ea;border-radius:18px;box-shadow:0 16px 48px var(--shadow);overflow:hidden;transition:filter .3s ease}
  .hero.blurred{filter:blur(6px)}

  /* Slideshow (flip + cute hearts) */
  .slide-area{position:relative;aspect-ratio:16/9;display:grid;place-items:center;background:linear-gradient(135deg,#ffdbe8,#e8fff7);perspective:1600px}
  .slide{position:absolute;inset:0;display:grid;grid-template-rows:1fr auto;opacity:0;transform:rotateY(0deg);transition:opacity .6s ease}
  .slide figure{margin:0;position:relative;display:grid;place-items:center;overflow:hidden}
  .slide img{width:100%;height:100%;object-fit:contain}
  .slide.active{opacity:1;animation:flipIn .8s cubic-bezier(.22,.61,.36,1)}
  .slide.out{opacity:0;animation:flipOut .8s cubic-bezier(.22,.61,.36,1)}
  @keyframes flipIn{
    0%{transform:rotateY(-180deg); filter:drop-shadow(0 10px 20px rgba(0,0,0,.15))}
    60%{transform:rotateY(-10deg)}
    100%{transform:rotateY(0deg)}
  }
  @keyframes flipOut{ 0%{transform:rotateY(0deg)} 100%{transform:rotateY(180deg); opacity:0} }
  .caption{background:rgba(255,255,255,.92);border-top:1px solid #ffd6e6;padding:12px 14px;display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .cap-title{font-weight:700}
  .cap-meta{display:flex;gap:8px;flex-wrap:wrap}
  .cap-meta span{background:#fff0f6;border:1px solid #ffd6e6;border-radius:999px;padding:4px 10px}

  /* Transition hearts during flip */
  .trans-heart{position:absolute;pointer-events:none;font-size:24px;animation:float 1s ease-out forwards}
  @keyframes float{
    0%{transform:translateY(0) translateX(0) scale(.8); opacity:0}
    60%{opacity:1}
    100%{transform:translateY(-60px) translateX(40px) scale(1.3); opacity:0}
  }

  /* Background hearts waterfall */
  .heart-stream{position:fixed;inset:0;pointer-events:none;z-index:1}
  .heart{position:absolute;top:-10vh;font-size:clamp(16px,2.8vw,28px);opacity:.85;animation:fall linear forwards}
  @keyframes fall{to{transform:translateY(115vh) rotate(360deg);opacity:.95}}

  /* Countdown popup (YES/NO) */
  #cdBackdrop{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.35);backdrop-filter:blur(2px);z-index:90}
  #cdBackdrop.active{display:flex}
  #cdBox{background:#fff;border-radius:20px;max-width:620px;width:calc(100% - 40px);padding:28px;text-align:center;box-shadow:0 28px 70px var(--shadow)}
  #cdNum{font-size:clamp(24px,6vw,42px);font-weight:800;color:#b91c1c}

  /* Fireworks overlay (bolder) */
  #fxBackdrop{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(10,10,10,.28);backdrop-filter:blur(3px);z-index:95}
  #fxBackdrop.active{display:flex}
  #fxCanvas{width:100vw;height:100vh;display:block}
  #fxText{
    position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
    font-weight:900; letter-spacing:.5px; text-align:center; line-height:1.2;
    font-size:clamp(28px,5vw,56px); color:#ffffff; text-shadow:0 2px 10px rgba(0,0,0,.45);
    animation:fxTextIn .6s ease-out both;
  }
  @keyframes fxTextIn{
    0%{transform:translateY(14px); opacity:0}
    100%{transform:translateY(0); opacity:1}
  }

  /* Music */
  #musicBtn{position:fixed;left:14px;bottom:14px;z-index:80}
  #musicPanel{position:fixed;left:14px;bottom:68px;z-index:80;width:min(360px,calc(100% - 28px));background:#fff;border:1px solid #ffd6e6;border-radius:14px;box-shadow:0 16px 40px var(--shadow);padding:12px;display:none}
  #musicPanel.active{display:block}
  .pill{border-radius:999px;border:1px solid #ffd6e6;background:#fff;padding:6px 10px;font-size:.95rem;cursor:pointer}
</style>
<script src="https://www.youtube.com/iframe_api"></script>
</head>
<body>

<!-- Gate -->
<section id="gate" class="center">
  <div class="heart-stream" id="heartGate"></div>
  <div id="gateCard">
    <div class="badge" style="margin-bottom:8px">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô</div>
    <h1 style="margin:6px 0 8px">‡∏Ñ‡∏∏‡∏ì‡∏£‡∏±‡∏Å‡πÄ‡∏£‡∏≤‡πÑ‡∏´‡∏° üíï</h1>
    <p class="tiny">‡∏ï‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞ ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡πÑ‡∏õ‡∏ï‡πà‡∏≠</p>
    <div style="display:flex; gap:10px; justify-content:center; margin-top:12px">
      <button id="yesBtn" class="btn">Yes</button>
      <button id="noBtn" class="btn secondary">No</button>
    </div>
  </div>
</section>

<!-- Countdown Popup -->
<div id="cdBackdrop"><div id="cdBox"><p id="cdLine" class="tiny"></p></div></div>

<!-- Fireworks Overlay -->
<div id="fxBackdrop">
  <canvas id="fxCanvas"></canvas>
  <div id="fxText" class="hidden">Welcome to memory love Y&amp;I</div>
</div>

<!-- Main -->
<main id="main" class="hidden">
  <div class="heart-stream" id="heartMain"></div>
  <div class="wrap">
    <h1 class="title">M 1</h1>
    <div class="hero" id="hero">
      <div class="slide-area" id="slideArea"><!-- slides inject --></div>
    </div>
  </div>
</main>

<!-- Music -->
<div id="musicBtn"><button class="btn">üéµ Music</button></div>
<div id="musicPanel">
  <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap">
    <strong>‡πÄ‡∏û‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á</strong>
    <div style="display:flex;gap:6px;flex-wrap:wrap">
      <button id="btnPlay" class="pill">‚ñ∂Ô∏è ‡πÄ‡∏•‡πà‡∏ô</button>
      <button id="btnPause" class="pill">‚è∏Ô∏è ‡∏´‡∏¢‡∏∏‡∏î</button>
      <button id="btnPrev" class="pill">‚èÆÔ∏è</button>
      <button id="btnNext" class="pill">‚è≠Ô∏è</button>
      <button id="btnLoop" class="pill">üîÅ ‡∏ß‡∏ô</button>
      <button id="btnUnmute" class="pill">üîä ‡∏õ‡∏•‡∏î‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á</button>
    </div>
  </div>
  <div class="tiny" style="margin-top:6px">* ‡∏ñ‡πâ‡∏≤‡∏ü‡∏±‡∏á‡πÑ‡∏°‡πà‡∏î‡∏±‡∏á ‡πÉ‡∏´‡πâ‡∏Å‡∏î ‚Äú‡∏õ‡∏•‡∏î‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‚Äù ‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>
</div>
<div style="position:absolute;left:-9999px;top:-9999px;height:0;width:0;overflow:hidden">
  <div id="ytplayer"></div>
</div>

<script>
/* ============== DATA: ‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå raw GitHub ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ============== */
const SLIDES = [
  { src:'https://raw.githubusercontent.com/<user>/<repo>/main/images/slide01.jpg', place:'‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà 1', date:'01 ‡∏°.‡∏Ñ. 2025', desc:'‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢‡∏†‡∏≤‡∏û 1'},
  { src:'https://raw.githubusercontent.com/<user>/<repo>/main/images/slide02.jpg', place:'‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà 2', date:'02 ‡∏°.‡∏Ñ. 2025', desc:'‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢‡∏†‡∏≤‡∏û 2'},
  { src:'https://raw.githubusercontent.com/<user>/<repo>/main/images/slide03.jpg', place:'‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà 3', date:'03 ‡∏°.‡∏Ñ. 2025', desc:'‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢‡∏†‡∏≤‡∏û 3'},
  { src:'https://raw.githubusercontent.com/<user>/<repo>/main/images/slide04.jpg', place:'‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà 4', date:'04 ‡∏°.‡∏Ñ. 2025', desc:'‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢‡∏†‡∏≤‡∏û 4'},
  { src:'https://raw.githubusercontent.com/<user>/<repo>/main/images/slide05.jpg', place:'‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà 5', date:'05 ‡∏°.‡∏Ñ. 2025', desc:'‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢‡∏†‡∏≤‡∏û 5'},
  { src:'https://raw.githubusercontent.com/<user>/<repo>/main/images/slide06.jpg', place:'‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà 6', date:'06 ‡∏°.‡∏Ñ. 2025', desc:'‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢‡∏†‡∏≤‡∏û 6'},
  { src:'https://raw.githubusercontent.com/<user>/<repo>/main/images/slide07.jpg', place:'‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà 7', date:'07 ‡∏°.‡∏Ñ. 2025', desc:'‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢‡∏†‡∏≤‡∏û 7'},
  { src:'https://raw.githubusercontent.com/<user>/<repo>/main/images/slide08.jpg', place:'‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà 8', date:'08 ‡∏°.‡∏Ñ. 2025', desc:'‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢‡∏†‡∏≤‡∏û 8'},
  { src:'https://raw.githubusercontent.com/<user>/<repo>/main/images/slide09.jpg', place:'‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà 9', date:'09 ‡∏°.‡∏Ñ. 2025', desc:'‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢‡∏†‡∏≤‡∏û 9'},
  { src:'https://raw.githubusercontent.com/<user>/<repo>/main/images/slide10.jpg', place:'‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà 10',date:'10 ‡∏°.‡∏Ñ. 2025', desc:'‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢‡∏†‡∏≤‡∏û 10'},
];

/* ===== Gate logic ===== */
const gate = document.getElementById('gate');
const main = document.getElementById('main');
const hero = document.getElementById('hero');
const yesBtn = document.getElementById('yesBtn');
const noBtn = document.getElementById('noBtn');
const cdBackdrop = document.getElementById('cdBackdrop');
const cdLine = document.getElementById('cdLine');

noBtn.addEventListener('click', ()=>{
  cdLine.innerHTML = '‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏¥‡πÉ‡∏´‡πà‡πÑ‡∏°‡πà‡∏£‡∏±‡∏Å‡∏´‡∏£‡∏≠‡∏Å‡∏ô‡∏∞ üòíüôÑüò§ ‡∏à‡∏∞‡∏õ‡∏¥‡∏î‡πÉ‡∏ô <strong id="cdNum">5</strong> ‡∏ß‡∏¥';
  cdBackdrop.classList.add('active');
  let t=5; const n=()=>document.getElementById('cdNum');
  const timer=setInterval(()=>{ t--; n().textContent=t; if(t<=0){ clearInterval(timer); cdBackdrop.classList.remove('active'); } },1000);
});

yesBtn.addEventListener('click', ()=>{
  // ‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á 5 ‡∏ß‡∏¥ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
  cdLine.innerHTML = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏´‡∏ß‡∏≤‡∏ô‡πÉ‡∏à‡πÑ‡∏õ‡∏™‡∏π‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏£‡∏á‡∏à‡∏≥‡∏≠‡∏±‡∏ô‡∏´‡∏ß‡∏≤‡∏ô‡∏ä‡∏∑‡πà‡∏ô‚Ä¶ ‡πÉ‡∏ô <strong id="cdNum">5</strong> ‡∏ß‡∏¥';
  cdBackdrop.classList.add('active');
  let t=5; const n=()=>document.getElementById('cdNum');
  const timer=setInterval(()=>{
    t--; n().textContent=t;
    if(t<=0){
      clearInterval(timer);
      cdBackdrop.classList.remove('active');

      // ‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤ main + ‡∏û‡∏•‡∏∏ + ‡πÄ‡∏ö‡∏•‡∏≠‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á + ‡∏õ‡∏•‡∏î‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏û‡∏•‡∏á
      gate.classList.add('hidden');
      main.classList.remove('hidden');
      hero.classList.add('blurred');
      try{ ytPlayer.unMute(); }catch(e){}
      startFireworks(4000, ()=>{
        hero.classList.remove('blurred');
        startSlides();
      });
    }
  },1000);
});

/* ===== Hearts waterfall ===== */
function spawnHearts(containerId){
  const stream = document.getElementById(containerId);
  const hearts=['üíó','üíñ','üíì','üíû','üíù','üíò','üíü'];
  setInterval(()=>{
    const h=document.createElement('div');
    h.className='heart';
    h.textContent=hearts[Math.floor(Math.random()*hearts.length)];
    h.style.left=(Math.random()*100)+'%';
    h.style.animationDuration=(6+Math.random()*6)+'s';
    stream.appendChild(h);
    setTimeout(()=>h.remove(),13000);
  }, 420);
}
spawnHearts('heartGate'); spawnHearts('heartMain');

/* ===== Slideshow (flip w/ hearts) ===== */
const slideArea = document.getElementById('slideArea');
let slideIndex=0, slideTimer=null, DURATION=3000;

function renderSlides(){
  slideArea.innerHTML='';
  SLIDES.forEach((s,i)=>{
    const el=document.createElement('div');
    el.className='slide';
    el.innerHTML = `
      <figure><img src="${s.src}" alt="slide ${i+1}"></figure>
      <figcaption class="caption">
        <span class="cap-title">‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà ${i+1}/10</span>
        <div class="cap-meta"><span>üìç ${s.place||''}</span><span>üóìÔ∏è ${s.date||''}</span></div>
        <div class="tiny">${s.desc||''}</div>
      </figcaption>`;
    slideArea.appendChild(el);
  });
}
function showSlide(next){
  const slides=[...document.querySelectorAll('.slide')];
  slides.forEach(el=> el.classList.remove('active','out'));
  const prev=slideIndex, outEl=slides[prev]; if(outEl){ outEl.classList.add('out'); }
  slideIndex=next;
  const inEl=slides[slideIndex]; if(inEl){ inEl.classList.add('active'); spawnTransitionHearts(); }
}
function nextSlide(){ showSlide((slideIndex+1)%SLIDES.length); }
function startSlides(){
  if(!SLIDES.length) return;
  renderSlides(); slideIndex=0; showSlide(0);
  clearInterval(slideTimer); slideTimer=setInterval(nextSlide, DURATION);
}
function spawnTransitionHearts(){
  const hearts=['üíó','üíñ','üíì','üíû','üíù'];
  for(let i=0;i<7;i++){
    const h=document.createElement('div');
    h.className='trans-heart';
    h.textContent=hearts[(Math.random()*hearts.length)|0];
    h.style.left=(10+Math.random()*80)+'%';
    h.style.bottom=(10+Math.random()*40)+'px';
    slideArea.appendChild(h);
    setTimeout(()=>h.remove(),1000);
  }
}

/* ===== Fireworks (bolder to center + text) ===== */
const fxBackdrop=document.getElementById('fxBackdrop');
const fxCanvas=document.getElementById('fxCanvas');
const fxText=document.getElementById('fxText');
const ctx=fxCanvas.getContext('2d');
let fwParticles=[], fwRaf=null;

function resizeCanvas(){ fxCanvas.width=window.innerWidth; fxCanvas.height=window.innerHeight; }
window.addEventListener('resize', resizeCanvas);

function startFireworks(duration=4000, onDone=()=>{}){
  resizeCanvas();
  fxText.classList.remove('hidden');
  fxBackdrop.classList.add('active');
  fwParticles=[];
  const start=performance.now();

  function spawnRocket(){
    const x = Math.random()*fxCanvas.width*0.8 + fxCanvas.width*0.1;
    const y = fxCanvas.height + 20;
    const targetY = fxCanvas.height*0.45 + (Math.random()*40-20); // üéØ ‡πÉ‡∏Å‡∏•‡πâ‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠
    const vy = - (8 + Math.random()*3);
    const vx = (Math.random()-.5)*1.2;
    fwParticles.push({type:'rocket',x,y,vx,vy,targetY,color:randColor(),life:700});
  }
  function explode(x,y,color){
    const count = 120; // ‡πÄ‡∏¢‡∏≠‡∏∞‡∏Ç‡∏∂‡πâ‡∏ô ‡∏ä‡∏±‡∏î‡∏Ç‡∏∂‡πâ‡∏ô
    for(let i=0;i<count;i++){
      const angle = Math.random()*Math.PI*2;
      const speed = 2.5+Math.random()*3.5;
      const size = 1.5+Math.random()*2.2;
      fwParticles.push({type:'spark',x,y,vx:Math.cos(angle)*speed,vy:Math.sin(angle)*speed,alpha:1,color,life:700,size});
    }
    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏â‡∏Å‡πÅ‡∏™‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠
    for(let i=0;i<10;i++){
      fwParticles.push({type:'ray',x,y,dir:i,alpha:1,color,life:500});
    }
  }
  function randColor(){
    const cols=['#ff7aa2','#ffd166','#06d6a0','#70a1ff','#f78fb3','#c56cf0','#f94144','#43aa8b'];
    return cols[(Math.random()*cols.length)|0];
  }

  function tick(now){
    const elapsed = now - start;
    ctx.clearRect(0,0,fxCanvas.width,fxCanvas.height);

    if(Math.random()<0.12) spawnRocket();

    fwParticles.forEach(p=>{
      if(p.type==='rocket'){
        p.x+=p.vx; p.y+=p.vy; p.vy+=0.08; p.life-=16;
        // ‡∏Ñ‡∏ß‡∏±‡∏ô/‡πÑ‡∏≠‡∏û‡πà‡∏ô
        ctx.fillStyle='rgba(255,255,255,.8)';
        ctx.fillRect(p.x, p.y, 2, 10);
        if(p.y <= p.targetY || p.life<=0){ p.life=-1; explode(p.x,p.y,p.color); }
      }else if(p.type==='spark'){
        p.x+=p.vx; p.y+=p.vy; p.vy+=0.03; p.life-=16; p.alpha-=0.012;
        ctx.fillStyle=p.color; ctx.globalAlpha=Math.max(0,p.alpha);
        ctx.beginPath(); ctx.arc(p.x,p.y,p.size||2,0,Math.PI*2); ctx.fill();
        ctx.globalAlpha=1;
      }else if(p.type==='ray'){
        p.life-=16; p.alpha-=0.03;
        ctx.strokeStyle=p.color; ctx.globalAlpha=Math.max(0,p.alpha);
        ctx.lineWidth=2;
        const len = 90;
        ctx.beginPath();
        const ang = (Math.PI*2/10)*p.dir;
        ctx.moveTo(p.x, p.y);
        ctx.lineTo(p.x + Math.cos(ang)*len, p.y + Math.sin(ang)*len);
        ctx.stroke(); ctx.globalAlpha=1;
      }
    });
    fwParticles = fwParticles.filter(p=>p.life>0);

    if(elapsed < duration){
      fwRaf = requestAnimationFrame(tick);
    }else{
      cancelAnimationFrame(fwRaf);
      fxBackdrop.classList.remove('active');
      fxText.classList.add('hidden');
      onDone();
    }
  }
  fwRaf = requestAnimationFrame(tick);
}

/* ===== Music (YouTube) ‚Äî autoplay BEFORE gate (muted), unmute after YES ===== */
const musicBtn=document.getElementById('musicBtn');
const musicPanel=document.getElementById('musicPanel');
const btnPlay=document.getElementById('btnPlay');
const btnPause=document.getElementById('btnPause');
const btnPrev=document.getElementById('btnPrev');
const btnNext=document.getElementById('btnNext');
const btnLoop=document.getElementById('btnLoop');
const btnUnmute=document.getElementById('btnUnmute');

musicBtn.addEventListener('click', ()=> musicPanel.classList.toggle('active'));

let ytPlayer, ytReady=false;
const MUSIC={ urls:['https://youtu.be/0P6P115Wh8Y?list=PL1yLr3qFTpM_GMpbbjAeM4hNd6SbDqIXF'], index:0, loop:true };

window.onYouTubeIframeAPIReady = function(){
  ytReady = true;
  const {vid, list} = parseYouTube(MUSIC.urls[MUSIC.index]);
  initPlayer(vid, list);
};

function initPlayer(videoId, listId){
  ytPlayer = new YT.Player('ytplayer', {
    height:'0', width:'0',
    videoId: videoId,
    playerVars:{ playsinline:1, autoplay:1, mute:1, loop:1, playlist: listId || videoId },
    events:{ 'onReady': onYtReady, 'onStateChange': onYtState }
  });
}
function onYtReady(){
  try{
    ytPlayer.mute();      // ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á
    ytPlayer.playVideo(); // ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (autoplay allowed ‡πÄ‡∏°‡∏∑‡πà‡∏≠ mute)
  }catch(e){}
}
function loadAndPlay(force=false){
  if(!ytReady) return;
  const {vid, list}=parseYouTube(MUSIC.urls[MUSIC.index]);
  if(!ytPlayer){ initPlayer(vid, list); return; }
  if(list){ ytPlayer.loadPlaylist({list:list, index:0}); } else { ytPlayer.loadVideoById(vid); }
  if(force){ try{ ytPlayer.playVideo(); }catch(e){} }
}
function onYtState(e){
  // ‡∏ñ‡πâ‡∏≤‡∏à‡∏ö‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ playlist ‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏õ‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß
  if(e.data===0 && !hasPlaylist(MUSIC.urls[MUSIC.index])){ try{ ytPlayer.playVideo(); }catch(e){} }
}
// Controls
btnPlay.addEventListener('click', ()=> loadAndPlay(true));
btnPause.addEventListener('click', ()=>{ try{ ytPlayer.pauseVideo(); }catch(e){} });
btnPrev .addEventListener('click', ()=>{ MUSIC.index=(MUSIC.index-1+MUSIC.urls.length)%MUSIC.urls.length; loadAndPlay(true); });
btnNext .addEventListener('click', ()=>{ MUSIC.index=(MUSIC.index+1)%MUSIC.urls.length; loadAndPlay(true); });
btnLoop.addEventListener('click', ()=>{ MUSIC.loop=!MUSIC.loop; btnLoop.style.borderColor = MUSIC.loop? '#b6f0c8':'#ffd6e6'; });
btnUnmute.addEventListener('click', ()=>{ try{ ytPlayer.unMute(); }catch(e){} });

// fallback: ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÉ‡∏î ‡πÜ ‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤ = ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÄ‡∏•‡πà‡∏ô (‡∏Å‡∏±‡∏ô‡πÄ‡∏Ñ‡∏™‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÄ‡∏Ç‡πâ‡∏°‡∏á‡∏ß‡∏î)
document.addEventListener('click', ()=> loadAndPlay(true), {once:true});

function hasPlaylist(url){ try{ const u=new URL(url); return !!u.searchParams.get('list'); }catch(e){ return false; } }
function parseYouTube(url){
  try{
    const u=new URL(url);
    const list=u.searchParams.get('list')||null;
    let vid=u.searchParams.get('v')||null;
    if(u.hostname.includes('youtu.be')) vid=u.pathname.replace('/','');
    if(!vid && u.pathname.includes('/embed/')) vid=u.pathname.split('/embed/')[1];
    if(!vid){ const m=url.match(/[?&]v=([^&#]+)/); if(m) vid=m[1]; }
    return {vid, list};
  }catch(e){
    const m=url.match(/[?&]v=([^&#]+)/);
    return {vid: m?m[1]:null, list:null};
  }
}
</script>

<!-- background hearts (extra gentle) -->
<div class="heart-stream" id="heartBg" style="z-index:0"></div>
<script>
  (function(){
    const stream=document.getElementById('heartBg');
    const hearts=['üíó','üíñ','üíì','üíû','üíù','üíò','üíü'];
    setInterval(()=>{
      const h=document.createElement('div');
      h.className='heart';
      h.textContent=hearts[(Math.random()*hearts.length)|0];
      h.style.left=(Math.random()*100)+'%';
      h.style.animationDuration=(10+Math.random()*10)+'s';
      stream.appendChild(h);
      setTimeout(()=>h.remove(),20000);
    },800);
  })();
</script>
</body>
</html>
