<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>‡∏Ñ‡∏∏‡∏ì‡∏£‡∏±‡∏Å‡πÄ‡∏£‡∏≤‡πÑ‡∏´‡∏° üíï ‚Üí M1 Memory</title>

<!-- ‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡πÑ‡∏ó‡∏¢‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å -->
<link href="https://fonts.googleapis.com/css2?family=Mali:wght@300;400;600;700&family=Kanit:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="preconnect" href="https://raw.githubusercontent.com" crossorigin>

<style>
  :root{ --pink1:#ffe6ef; --pink3:#fbeafe; --text:#3d2b3a; --muted:#6f5b66; --shadow:rgba(0,0,0,.16); --card:#ffffff; }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:"Kanit","Inter","Noto Sans Thai",system-ui,sans-serif;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;color:var(--text);background:linear-gradient(135deg,var(--pink1),var(--pink3))}
  .hidden{display:none!important}
  .center{display:flex;align-items:center;justify-content:center}
  .btn{cursor:pointer;padding:.9rem 1.2rem;border:none;border-radius:999px;background:#ff7aa2;color:#fff;font-weight:700;box-shadow:0 10px 24px var(--shadow);transition:.2s}
  .btn:hover{transform:translateY(-2px)}
  .btn.secondary{background:#fff;color:#ff7aa2;border:2px solid #ff7aa2}
  .tiny{font-size:.95rem;color:var(--muted)}
  .badge{display:inline-block;background:#ffe6ef;color:#c2185b;border-radius:999px;padding:6px 12px;font-weight:700}
  h1.title,#gateCard h1,.badge,.btn,.cap-title,#fxText{font-family:"Mali","Kanit","Noto Sans Thai",sans-serif;letter-spacing:.2px}

  /* Gate */
  #gate{min-height:100dvh;position:relative;overflow:hidden;padding:20px}
  #gateCard{max-width:760px;margin:auto;background:var(--card);border-radius:22px;box-shadow:0 16px 48px var(--shadow);padding:28px;text-align:center;position:relative;z-index:2}

  /* Main */
  #main{min-height:100dvh;position:relative;overflow:hidden;padding:28px;z-index:2}
  .wrap{max-width:980px;margin:0 auto;position:relative;z-index:2}
  h1.title{margin:8px 0 18px;text-align:center;font-size:clamp(28px,5vw,48px)}
  .hero{background:var(--card);border:1px solid #ffe0ea;border-radius:18px;box-shadow:0 16px 48px var(--shadow);overflow:hidden;transition:filter .3s ease;position:relative;z-index:2}
  .hero.blurred{filter:blur(6px)}

  /* Slide area 2:3 */
  .slide-area{
    --w:min(90vw,360px);
    width:var(--w);
    height:calc(var(--w)*1.5);
    margin:0 auto;
    position:relative;
    background:linear-gradient(135deg,#ffdbe8,#e8fff7);
    border-radius:14px;
    perspective:1600px;
    display:grid;place-items:center;
    overflow:hidden;z-index:2
  }
  .slide{position:absolute;inset:0;display:grid;grid-template-rows:1fr auto;opacity:0;transform:rotateY(0deg);transition:opacity .6s ease}
  .slide figure{margin:0;position:relative;display:grid;place-items:center;overflow:hidden}
  .slide img{width:100%;height:100%;object-fit:cover;object-position:center;background:transparent}
  .slide.active{opacity:1;animation:flipIn .8s cubic-bezier(.22,.61,.36,1)}
  .slide.out{opacity:0;animation:flipOut .8s cubic-bezier(.22,.61,.36,1)}
  .slide.instant{opacity:1 !important; animation:none !important; transform:none !important}

  @keyframes flipIn{0%{transform:rotateY(-180deg);filter:drop-shadow(0 10px 20px rgba(0,0,0,.15))}60%{transform:rotateY(-10deg)}100%{transform:rotateY(0)}}
  @keyframes flipOut{0%{transform:rotateY(0)}100%{transform:rotateY(180deg);opacity:0}}

  /* Caption */
  .caption{background:rgba(255,255,255,.92);border-top:1px solid #ffd6e6;padding:12px 14px;display:flex;gap:10px;align-items:flex-end;flex-wrap:wrap}
  .cap-title{font-weight:700}
  .cap-meta{display:flex;gap:8px;flex-wrap:wrap}
  .cap-meta span{background:#fff0f6;border:1px solid #ffd6e6;border-radius:999px;padding:4px 10px}
  .caption .tiny{margin-left:0;text-align:left}

  /* Hearts */
  .trans-heart{position:absolute;pointer-events:none;font-size:24px;animation:float 1s ease-out forwards}
  @keyframes float{0%{transform:translateY(0) translateX(0) scale(.8);opacity:0}60%{opacity:1}100%{transform:translateY(-60px) translateX(40px) scale(1.3);opacity:0}}
  .heart-stream{position:fixed;inset:0;pointer-events:none;z-index:0}
  .heart{position:absolute;top:-10vh;font-size:clamp(16px,2.8vw,28px);opacity:.85;animation:fall linear forwards}
  @keyframes fall{to{transform:translateY(115vh) rotate(360deg);opacity:.95}}

  /* Popup */
  #cdBackdrop{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.35);backdrop-filter:blur(2px);z-index:90}
  #cdBackdrop.active{display:flex}
  #cdBox{background:#fff;border-radius:20px;max-width:620px;width:calc(100% - 40px);padding:28px;text-align:center;box-shadow:0 28px 70px var(--shadow)}
  #cdNum{font-size:clamp(24px,6vw,42px);font-weight:800;color:#b91c1c}

  /* Fireworks */
  #fxBackdrop{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(10,10,10,.28);backdrop-filter:blur(3px);z-index:95}
  #fxBackdrop.active{display:flex}
  #fxCanvas{width:100vw;height:100vh;display:block}
  #fxText{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-weight:700;letter-spacing:.5px;text-align:center;line-height:1.2;font-size:clamp(28px,5vw,56px);color:#fff;text-shadow:0 2px 10px rgba(0,0,0,.45)}

  /* Music button/panel ‚Üí right-bottom */
  #musicBtn{position:fixed;right:14px;bottom:14px;z-index:80}
  #musicPanel{
    position:fixed;right:14px;bottom:68px;z-index:80;
    width:min(360px,calc(100% - 28px));
    background:#fff;border:1px solid #ffd6e6;border-radius:14px;
    box-shadow:0 16px 40px var(--shadow);padding:12px;display:none
  }
  #musicPanel.active{display:block}
  .pill{border-radius:999px;border:1px solid #ffd6e6;background:#fff;padding:6px 10px;font-size:.95rem;cursor:pointer}
</style>
</head>
<body>

<!-- Gate -->
<section id="gate" class="center">
  <div class="heart-stream" id="heartGate"></div>
  <div id="gateCard">
    <div class="badge" style="margin-bottom:8px">‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏à‡∏∞‡∏ñ‡∏≤‡∏°‡∏•‡πà‡∏∞!!</div>
    <h1 style="margin:6px 0 8px">‡πÄ‡∏ò‡∏≠‡∏£‡∏±‡∏Å‡πÄ‡∏£‡∏≤‡πÑ‡∏´‡∏° üíï</h1>
    <p class="tiny">‡∏ï‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞ ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡πÑ‡∏õ‡∏ï‡πà‡∏≠</p>
    <div style="display:flex;gap:10px;justify-content:center;margin-top:12px">
      <button id="yesBtn" class="btn">Yes</button>
      <button id="noBtn" class="btn secondary">No</button>
    </div>
  </div>
</section>

<!-- Countdown -->
<div id="cdBackdrop"><div id="cdBox"><p id="cdLine" class="tiny"></p></div></div>

<!-- Fireworks -->
<div id="fxBackdrop">
  <canvas id="fxCanvas"></canvas>
  <div id="fxText">Welcome to memory love U&amp;I</div>
</div>

<!-- Main -->
<main id="main" class="hidden">
  <div class="heart-stream" id="heartMain"></div>
  <div class="wrap">
    <h1 class="title">M 1</h1>
    <div class="hero" id="hero">
      <div class="slide-area" id="slideArea"></div>
    </div>
  </div>
</main>

<!-- Music -->
<div id="musicBtn"><button class="btn">üéµ Music</button></div>
<div id="musicPanel">
  <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap">
    <strong>‡πÄ‡∏û‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á</strong>
    <div style="display:flex;gap:6px;flex-wrap:wrap">
      <button id="btnPlay" class="pill">‚ñ∂Ô∏è ‡πÄ‡∏•‡πà‡∏ô</button>
      <button id="btnPause" class="pill">‚è∏Ô∏è ‡∏´‡∏¢‡∏∏‡∏î</button>
      <button id="btnLoop" class="pill">üîÅ ‡∏ß‡∏ô</button>
      <button id="btnUnmute" class="pill">üîä ‡∏õ‡∏•‡∏î‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á</button>
    </div>
  </div>
  <div class="tiny" style="margin-top:6px">* ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏î‡∏±‡∏á ‡πÉ‡∏´‡πâ‡πÅ‡∏ï‡∏∞ ‚Äú‡∏õ‡∏•‡∏î‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‚Äù ‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á (‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î iOS)</div>
</div>

<script>
/* ===== CONFIG ===== */
const MUSIC_SRC = 'cuteJp.mp3'; // ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏õ‡πÇ‡∏î‡πÄ‡∏°‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ä‡πâ './audio/cuteJp.mp3'
const IMG_BASE  = 'https://raw.githubusercontent.com/ntu6008111004/lover/main/images/';
const IMAGES    = Array.from({length:10},(_,i)=> IMG_BASE + `slide${String(i+1).padStart(2,'0')}.jpg`);
const INTERVAL_MS = 4000;

/* ===== Gate logic ===== */
const gate = document.getElementById('gate');
const main = document.getElementById('main');
const hero = document.getElementById('hero');
const yesBtn = document.getElementById('yesBtn');
const noBtn = document.getElementById('noBtn');
const cdBackdrop = document.getElementById('cdBackdrop');
const cdLine = document.getElementById('cdLine');

noBtn.addEventListener('click', ()=>{
  cdLine.innerHTML = '‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏¥‡πÉ‡∏´‡πâ‡πÑ‡∏°‡πà‡∏£‡∏±‡∏Å‡∏´‡∏£‡∏≠‡∏Å‡∏ô‡∏∞ üòíüôÑüò§ ‡∏à‡∏∞‡∏õ‡∏¥‡∏î‡πÉ‡∏ô <strong id="cdNum">5</strong> ‡∏ß‡∏¥';
  cdBackdrop.classList.add('active');
  let t=5; const n=()=>document.getElementById('cdNum');
  const timer=setInterval(()=>{ t--; n().textContent=t; if(t<=0){ clearInterval(timer); cdBackdrop.classList.remove('active'); } },1000);
});

yesBtn.addEventListener('click', ()=>{
  cdLine.innerHTML = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏´‡∏ß‡∏≤‡∏ô‡πÉ‡∏à‡πÑ‡∏õ‡∏™‡∏π‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏£‡∏á‡∏à‡∏≥‡∏≠‡∏±‡∏ô‡∏´‡∏ß‡∏≤‡∏ô‡∏ä‡∏∑‡πà‡∏ô‚Ä¶ ‡πÉ‡∏ô <strong id="cdNum">5</strong> ‡∏ß‡∏¥';
  cdBackdrop.classList.add('active');
  let t=5; const n=()=>document.getElementById('cdNum');
  const timer=setInterval(()=>{
    t--; n().textContent=t;
    if(t<=0){
      clearInterval(timer);
      cdBackdrop.classList.remove('active');

      gate.classList.add('hidden');
      main.classList.remove('hidden');
      hero.classList.add('blurred');

      unmuteMusic(); // ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏û‡∏•‡∏á‡∏´‡∏•‡∏±‡∏á‡∏°‡∏µ gesture ‡πÅ‡∏•‡πâ‡∏ß

      startFireworks(4000, ()=>{
        hero.classList.remove('blurred');
        startSlides();
      });
    }
  },1000);
});

/* ===== Hearts background ===== */
function spawnHearts(containerId){
  const stream=document.getElementById(containerId);
  const hearts=['üíó','üíñ','üíì','üíû','üíù','üíò','üíü'];
  setInterval(()=>{
    const h=document.createElement('div'); h.className='heart';
    h.textContent=hearts[(Math.random()*hearts.length)|0];
    h.style.left=(Math.random()*100)+'%'; h.style.animationDuration=(6+Math.random()*6)+'s';
    stream.appendChild(h); setTimeout(()=>h.remove(),13000);
  },420);
}
spawnHearts('heartGate'); spawnHearts('heartMain');

/* ===== Slideshow ===== */
const slideArea = document.getElementById('slideArea');
let slideIndex=0, slideTimer=null;

const slideData = [
  { place: "Attika Studio", date: "03 ‡∏™.‡∏Ñ. 2025", desc: "‡∏´‡∏ß‡∏≤‡∏ô‡πÄ‡∏à‡∏µ‡πã‡∏¢‡∏ö‡∏ö‡∏ö‡∏ö‡∏ö‡∏ö‡∏ö‡∏ö" },
  { place: "Attika Studio", date: "03 ‡∏™.‡∏Ñ. 2025", desc: "‡∏ä‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏ò‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÅ‡∏´‡∏•‡∏∞" },
  { place: "Attika Studio", date: "03 ‡∏™.‡∏Ñ. 2025", desc: "‡πÑ‡∏°‡πà‡∏õ‡∏±‡πà‡∏ô‡πÑ‡∏°‡πà‡∏õ‡πà‡∏ß‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÄ‡∏£‡∏≤" },
  { place: "Attika Studio", date: "03 ‡∏™.‡∏Ñ. 2025", desc: "‡πÄ‡∏à‡πâ‡∏≤‡∏Ñ‡∏ô‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å" },
  { place: "The Haus 224", date: "24 ‡∏Å.‡∏Ñ. 2025", desc: "‡πÄ‡∏ö‡∏•‡∏≠‡∏ó‡∏µ‡πà‡πÅ‡∏õ‡∏•‡∏ß‡πà‡∏≤...‡πÑ‡∏£‡∏ô‡πâ‡∏≤‡∏≤‡∏≤" },
  { place: "The Haus 224", date: "24 ‡∏Å.‡∏Ñ. 2025", desc: "‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏≥‡πÑ‡∏°‡πÅ‡∏ö‡∏ö‡∏ô‡∏±‡πâ‡∏ô‡∏≠‡∏∞" },
  { place: "The Haus 224", date: "24 ‡∏Å.‡∏Ñ. 2025", desc: "‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥‡∏Å‡∏±‡∏ô‡∏ö‡πâ‡∏≤‡∏á‡∏™‡∏¥" },
  { place: "Attika Studio", date: "03 ‡∏™.‡∏Ñ. 2025", desc: "‡∏Ç‡∏≠‡∏´‡∏•‡πà‡∏≠‡πÄ‡∏ó‡πà‡∏£‡∏π‡∏õ‡∏ô‡∏∂‡πà‡∏á" },
  { place: "Attika Studio", date: "03 ‡∏™.‡∏Ñ. 2025", desc: "‡πÅ‡∏Ñ‡πà‡∏°‡∏≠‡∏á‡∏ï‡∏≤‡∏Å‡πá‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡∏´‡∏ô‡∏°..." },
  { place:  "Attika Studio", date: "03 ‡∏™.‡∏Ñ. 2025", desc: "‡πÅ‡∏ä‡πà‡∏∞‡πÜ‡πÜ‡πÜ" },
];

function renderSlides(urls){
  slideArea.innerHTML='';
  urls.forEach((u,i)=>{
    const data = slideData[i] || { place:"-", date:"-", desc:"-" };
    const el=document.createElement('div');
    el.className='slide';
    el.innerHTML=`
      <figure><img ${i===0?'loading="eager" fetchpriority="high"':''} src="${u}" crossorigin="anonymous"></figure>
      <figcaption class="caption">
        <span class="cap-title">‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà ${i+1}/10</span>
        <div class="cap-meta">
          <span>üìç ${data.place}</span>
          <span>üóìÔ∏è ${data.date}</span>
        </div>
        <div class="tiny">${data.desc}</div>
      </figcaption>`;
    slideArea.appendChild(el);
  });
}

function showSlide(next){
  const slides=[...document.querySelectorAll('.slide')];
  slides.forEach(el=>el.classList.remove('active','out'));
  const prev=slideIndex, outEl=slides[prev]; if(outEl){ outEl.classList.add('out'); }
  slideIndex=next;
  const inEl=slides[slideIndex];
  if(inEl){ inEl.classList.add('active'); spawnTransitionHearts(); }
}
function nextSlide(){ showSlide((slideIndex+1)%IMAGES.length); }

async function startSlides(){
  // preload & decode ‡∏£‡∏π‡∏õ‡πÅ‡∏£‡∏Å‡πÉ‡∏´‡πâ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏à‡∏£‡∏¥‡∏á
  const first = new Image();
  first.decoding = 'sync';
  first.crossOrigin = 'anonymous';
  first.src = IMAGES[0] + '?v=' + Date.now();
  try{
    if(first.decode){ await first.decode(); }
    else { await new Promise((res,rej)=>{ first.onload=res; first.onerror=rej; }); }
  }catch(_){}

  renderSlides(IMAGES);

  const firstSlide = slideArea.querySelector('.slide');
  firstSlide.classList.add('instant');
  requestAnimationFrame(()=>{
    requestAnimationFrame(()=>{
      firstSlide.classList.remove('instant');
      firstSlide.classList.add('active');
      clearInterval(slideTimer);
      slideTimer=setInterval(nextSlide, INTERVAL_MS);
    });
  });
}

function spawnTransitionHearts(){
  const H=['üíó','üíñ','üíì','üíû','üíù'];
  for(let i=0;i<7;i++){
    const h=document.createElement('div');
    h.className='trans-heart'; h.textContent=H[(Math.random()*H.length)|0];
    h.style.left=(10+Math.random()*80)+'%'; h.style.bottom=(10+Math.random()*40)+'px';
    slideArea.appendChild(h); setTimeout(()=>h.remove(),1000);
  }
}

/* ===== Fireworks (‡∏™‡∏±‡πâ‡∏ô) ===== */
const fxBackdrop=document.getElementById('fxBackdrop');
const fxCanvas=document.getElementById('fxCanvas');
const fxText=document.getElementById('fxText');
const ctx=fxCanvas.getContext('2d');
let fwParticles=[], fwRaf=null;
function resizeCanvas(){ fxCanvas.width=innerWidth; fxCanvas.height=innerHeight; }
addEventListener('resize', resizeCanvas);
function startFireworks(duration=4000,onDone=()=>{}){
  resizeCanvas(); fxText.style.display='flex'; fxBackdrop.classList.add('active'); fwParticles=[]; const start=performance.now();
  function rand(){ return ['#ff7aa2','#ffd166','#06d6a0','#70a1ff','#f78fb3','#c56cf0','#f94144','#43aa8b'][(Math.random()*8)|0]; }
  function spawn(){ const x=Math.random()*fxCanvas.width*0.8+fxCanvas.width*0.1, y=fxCanvas.height+20, tY=fxCanvas.height*0.45+(Math.random()*40-20); const vy=-(8+Math.random()*3), vx=(Math.random()-.5)*1.2; fwParticles.push({t:'r',x,y,vx,vy,tY,c:rand(),l:700}); }
  function boom(x,y,c){ for(let i=0;i<120;i++){ const a=Math.random()*Math.PI*2, s=2.5+Math.random()*3.5; fwParticles.push({t:'s',x,y,vx:Math.cos(a)*s,vy:Math.sin(a)*s,a1:1,c,l:700}); } }
  function tick(now){
    const e=now-start; ctx.clearRect(0,0,fxCanvas.width,fxCanvas.height);
    if(Math.random()<0.12) spawn();
    fwParticles.forEach(p=>{
      if(p.t==='r'){ p.x+=p.vx; p.y+=p.vy; p.vy+=0.08; p.l-=16;
        ctx.fillStyle='rgba(255,255,255,.8)'; ctx.fillRect(p.x,p.y,2,10);
        if(p.y<=p.tY||p.l<=0){ p.l=-1; boom(p.x,p.y,p.c); }
      }else{
        p.x+=p.vx; p.y+=p.vy; p.vy+=0.03; p.l-=16; p.a1-=0.012;
        ctx.fillStyle=p.c; ctx.globalAlpha=Math.max(0,p.a1);
        ctx.beginPath(); ctx.arc(p.x,p.y,2,0,Math.PI*2); ctx.fill(); ctx.globalAlpha=1;
      }
    });
    fwParticles=fwParticles.filter(p=>p.l>0);
    if(e<duration){ fwRaf=requestAnimationFrame(tick); }
    else { cancelAnimationFrame(fwRaf); fxBackdrop.classList.remove('active'); fxText.style.display='none'; onDone(); }
  }
  fwRaf=requestAnimationFrame(tick);
}

/* ===== Music (iOS-safe) ===== */
const musicBtn=document.getElementById('musicBtn');
const musicPanel=document.getElementById('musicPanel');
const btnPlay=document.getElementById('btnPlay');
const btnPause=document.getElementById('btnPause');
const btnLoop=document.getElementById('btnLoop');
const btnUnmute=document.getElementById('btnUnmute');
musicBtn?.addEventListener('click', ()=> musicPanel.classList.toggle('active'));

const bgMusic = new Audio(MUSIC_SRC);
bgMusic.preload = 'auto';
bgMusic.loop = true;
bgMusic.muted = true;        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏ö‡∏ö‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á
bgMusic.playsInline = true;  // ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ö‡∏ô iOS
bgMusic.setAttribute('playsinline','');
bgMusic.setAttribute('webkit-playsinline','');

let audioUnlocked = false;
function iosUnlockOnce(){
  if (audioUnlocked) return;
  bgMusic.play().then(()=>{
    bgMusic.pause();
    bgMusic.currentTime = 0;
    audioUnlocked = true;
  }).catch(()=>{});
}
['touchstart','pointerdown','click','keydown'].forEach(evt=>{
  document.addEventListener(evt, iosUnlockOnce, { once:true, passive:true });
});

function unmuteMusic(){
  iosUnlockOnce();
  bgMusic.muted = false;
  bgMusic.play().catch(()=>{});
}

/* Controls */
btnPlay  ?.addEventListener('click', unmuteMusic);
btnUnmute?.addEventListener('click', unmuteMusic);
btnPause ?.addEventListener('click', ()=> bgMusic.pause());
btnLoop  ?.addEventListener('click', ()=>{ bgMusic.loop=!bgMusic.loop; btnLoop.style.borderColor=bgMusic.loop?'#b6f0c8':'#ffd6e6'; });
</script>
</body>
</html>
